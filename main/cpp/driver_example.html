

<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="Driver Example" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://arrow.apache.org/adbc/main/cpp/driver_example.html" />
<meta property="og:site_name" content="ADBC" />
<meta property="og:description" content="Recipe source: driver_example.cc Here we’ll show the structure of building an ADBC driver in C++ using the ADBC driver framework library. This is the same library that ADBC uses to build its SQLite..." />
<meta property="og:image" content="https://arrow.apache.org/adbc/main/_static/banner.png" />
<meta property="og:image:alt" content="ADBC" />
<meta name="description" content="Recipe source: driver_example.cc Here we’ll show the structure of building an ADBC driver in C++ using the ADBC driver framework library. This is the same library that ADBC uses to build its SQLite..." />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="C/C++ API Reference" href="api/index.html" /><link rel="prev" title="Concurrency and Thread Safety" href="concurrency.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>Driver Example - ADBC 16 (dev) documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=56d6027c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style>
<script>
  const currentVersion = "16 (dev)";
  const versionsRoot = "../..";
</script>
<style>
  #version-switcher {
    background: var(--color-background-primary);
    bottom: 2em;
    box-shadow: 0 .1rem .25rem var(--sd-color-shadow),0 0 .0625rem rgba(0,0,0,.1);
    position: fixed;
    right: 2em;
    z-index: 9999;
  }

  #version-switcher button {
    background-color: var(--sd-color-card-header);
    border: 0;
    color: var(--sd-color-card-text);
    cursor: pointer;
    font-family: var(--font-stack);
    padding: 0.5em;
    width: 100%;
  }

  #version-switcher button::after {
    content: "▼";
  }

  #version-switcher.open button::after {
    content: "▲";
  }

  #version-switcher div.versions {
    height: 0;
    overflow-y: hidden;
    padding: 0 0.5em;
    transition: all 0.2s ease-in;
  }

  #version-switcher.open div.versions {
    height: 8em;
    overflow-y: scroll;
  }

  #version-switcher .active {
    font-weight: bold;
  }
</style>
</head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    
<nav id="version-switcher">
  <button type="button" onclick="document.getElementById('version-switcher').classList.toggle('open')">Version: 16 (dev)</button>
  <div class="versions">
    <ul></ul>
  </div>
</nav>

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">ADBC 16 (dev) documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../_static/logo-light.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../_static/logo-dark.png" alt="Dark Logo"/>
  </div>
  
  <span class="sidebar-brand-text">ADBC 16 (dev) documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Supported Environments</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">C/C++</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of C/C++</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="driver_manager.html">Driver Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="concurrency.html">Concurrency and Thread Safety</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Driver Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/index.html">C/C++ API Reference</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../csharp/index.html">C#/.NET</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pkg.go.dev/github.com/apache/arrow-adbc/go/adbc">Go</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../java/index.html">Java</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Java</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../java/quickstart.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../java/driver_manager.html">Driver Manager</a></li>
<li class="toctree-l2"><a class="reference internal" href="../java/api/index.html">Java API Reference</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../python/index.html">Python</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Python</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../python/quickstart.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python/driver_manager.html">Driver Manager</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../python/api/index.html">Python API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of Python API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../python/api/adbc_driver_manager.html"><code class="docutils literal notranslate"><span class="pre">adbc_driver_manager</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../python/api/adbc_driver_flightsql.html"><code class="docutils literal notranslate"><span class="pre">adbc_driver_flightsql</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../python/api/adbc_driver_postgresql.html"><code class="docutils literal notranslate"><span class="pre">adbc_driver_postgresql</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../python/api/adbc_driver_sqlite.html"><code class="docutils literal notranslate"><span class="pre">adbc_driver_sqlite</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../python/recipe/index.html">Python Cookbook</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Python Cookbook</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../python/recipe/driver_manager.html">DBAPI/Driver Manager Recipes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python/recipe/flight_sql.html">Flight SQL Recipes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../python/recipe/postgresql.html">PostgreSQL Recipes</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../r/index.html">R</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Drivers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../driver/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/status.html">Driver Implementation Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/duckdb.html">DuckDB Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/flight_sql.html">Flight SQL Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/jdbc.html">JDBC Adapter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/postgresql.html">PostgreSQL Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/snowflake.html">Snowflake Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/sqlite.html">SQLite Driver</a></li>
<li class="toctree-l1"><a class="reference internal" href="../driver/authoring.html">Writing New Drivers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Specification</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../format/specification.html">ADBC API Standard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format/versioning.html">Versioning and Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format/comparison.html">Comparison with Other APIs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format/how_manager.html">How Drivers and the Driver Manager Work Together</a></li>
<li class="toctree-l1"><a class="reference internal" href="../format/related_work.html">Related Work</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../development/contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/nightly.html">Nightly Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/versioning.html">Versioning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/releasing.html">Release Management Guide</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/apache/arrow-adbc/blob/main/docs/source/cpp/driver_example.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/apache/arrow-adbc/edit/main/docs/source/cpp/driver_example.rst" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="driver-example">
<h1>Driver Example<a class="headerlink" href="#driver-example" title="Link to this heading">¶</a></h1>
<p>Recipe source: <a class="reference external" href="https://github.com/apache/arrow-adbc/blob/main/docs/source/cpp/recipe_driver/driver_example.cc">driver_example.cc</a></p>
<p>Here we’ll show the structure of building an ADBC driver in C++ using
the ADBC driver framework library. This is the same library that ADBC
uses to build its SQLite and PostgreSQL drivers and abstracts away
the details of C callables and catalog/metadata functions that can be
difficult to implement but are essential for efficiently leveraging
the rest of the ADBC ecosystem.</p>
<p>At a high level, we’ll be building a driver whose “database” is a directory
where each “table” in the database is a file containing an Arrow IPC stream.
Tables can be written using the bulk ingest feature and tables can be read
with a simple query in the form <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">(the</span> <span class="pre">file)</span></code>.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>This quickstart is actually a literate C++ file.  You can clone
the repository, build the sample, and follow along.</p>
<p>We’ll assume you’re using <a class="reference external" href="https://conda-forge.org/">conda-forge</a> for dependencies.  CMake, a
C++17 compiler, and the ADBC libraries are required.  They can be
installed as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mamba<span class="w"> </span>install<span class="w"> </span>cmake<span class="w"> </span>compilers<span class="w"> </span>libadbc-driver-manager
</pre></div>
</div>
</section>
<section id="building">
<h2>Building<a class="headerlink" href="#building" title="Link to this heading">¶</a></h2>
<p>We’ll use <a class="reference external" href="https://cmake.org/">CMake</a> here.  From a source checkout of the ADBC repository:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>../docs/source/cpp/recipe_driver<span class="w"> </span>-DADBC_DRIVER_EXAMPLE_BUILD_TESTS<span class="o">=</span>ON
cmake<span class="w"> </span>--build<span class="w"> </span>.
ctest
</pre></div>
</div>
</section>
<section id="building-an-adbc-driver-using-c">
<h2>Building an ADBC Driver using C++<a class="headerlink" href="#building-an-adbc-driver-using-c" title="Link to this heading">¶</a></h2>
<p>Let’s start with some includes. Notably, we’ll need the driver framework
header files and <a class="reference external" href="https://arrow.apache.org/nanoarrow">nanoarrow</a>, which we’ll use to create and consume the
Arrow C data interface structures in this example driver.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">72</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;driver_example.h&quot;</span>
<span class="linenos">73</span>
<span class="linenos">74</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdio&gt;</span>
<span class="linenos">75</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<span class="linenos">76</span>
<span class="linenos">77</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;driver/framework/connection.h&quot;</span>
<span class="linenos">78</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;driver/framework/database.h&quot;</span>
<span class="linenos">79</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;driver/framework/statement.h&quot;</span>
<span class="linenos">80</span>
<span class="linenos">81</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;nanoarrow/nanoarrow.hpp&quot;</span>
<span class="linenos">82</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;nanoarrow/nanoarrow_ipc.hpp&quot;</span>
<span class="linenos">83</span>
<span class="linenos">84</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;arrow-adbc/adbc.h&quot;</span>
</pre></div>
</div>
<p>Next, we’ll bring a few essential framework types into the namespace
to reduce the verbosity of the implementation:</p>
<ul>
<li><p><a class="reference external" href="https://arrow.apache.org/adbc/main/cpp/api/classadbc_1_1driver_1_1Option.html#classadbc_1_1driver_1_1Option" title="(in ADBC C vversion)"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">adbc::driver::Option</span></code></a> : Options can be set on an ADBC database,
connection, and statmenent. They can be strings, opaque binary, doubles, or
integers.  The <code class="docutils literal notranslate"><span class="pre">Option</span></code> class abstracts the details of how to get, set,
and parse these values.</p></li>
<li><p><a class="reference external" href="https://arrow.apache.org/adbc/main/cpp/api/classadbc_1_1driver_1_1Status.html#classadbc_1_1driver_1_1Status" title="(in ADBC C vversion)"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">adbc::driver::Status</span></code></a>: The <code class="docutils literal notranslate"><span class="pre">Status</span></code> is the ADBC driver
framework’s error handling mechanism: functions with no return value that
can fail return a <code class="docutils literal notranslate"><span class="pre">Status</span></code>.  You can use <code class="docutils literal notranslate"><span class="pre">UNWRAP_STATUS(some_call())</span></code> as
shorthand for <code class="docutils literal notranslate"><span class="pre">Status</span> <span class="pre">status</span> <span class="pre">=</span> <span class="pre">some_call();</span> <span class="pre">if</span> <span class="pre">(!status.ok())</span> <span class="pre">return</span>
<span class="pre">status;</span></code> to succinctly propagate errors.</p></li>
<li><p><a class="reference external" href="https://arrow.apache.org/adbc/main/cpp/api/classadbc_1_1driver_1_1Result.html#classadbc_1_1driver_1_1Result" title="(in ADBC C vversion)"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">adbc::driver::Result</span></code></a>: The <code class="docutils literal notranslate"><span class="pre">Result&lt;T&gt;</span></code> is used as a return
value for functions that on success return a value of type <code class="docutils literal notranslate"><span class="pre">T</span></code> and on
failure communicate their error using a <code class="docutils literal notranslate"><span class="pre">Status</span></code>. You can use
<code class="docutils literal notranslate"><span class="pre">UNWRAP_RESULT(some_type</span> <span class="pre">value,</span> <span class="pre">some_call())</span></code> as shorthand for</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">some_type</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
<span class="n">Result</span><span class="o">&lt;</span><span class="n">some_type</span><span class="o">&gt;</span><span class="w"> </span><span class="n">maybe_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">some_call</span><span class="p">();</span>
<span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">maybe_value</span><span class="p">.</span><span class="n">status</span><span class="p">().</span><span class="n">ok</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">maybe_value</span><span class="p">.</span><span class="n">status</span><span class="p">();</span>
<span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">maybe_value</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</li>
</ul>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">113</span><span class="k">using</span><span class="w"> </span><span class="n">adbc</span><span class="o">::</span><span class="n">driver</span><span class="o">::</span><span class="n">Option</span><span class="p">;</span>
<span class="linenos">114</span><span class="k">using</span><span class="w"> </span><span class="n">adbc</span><span class="o">::</span><span class="n">driver</span><span class="o">::</span><span class="n">Result</span><span class="p">;</span>
<span class="linenos">115</span><span class="k">using</span><span class="w"> </span><span class="n">adbc</span><span class="o">::</span><span class="n">driver</span><span class="o">::</span><span class="n">Status</span><span class="p">;</span>
<span class="linenos">116</span>
<span class="linenos">117</span><span class="k">namespace</span><span class="w"> </span><span class="p">{</span>
</pre></div>
</div>
<p>Next, we’ll provide the database implementation. The driver framework uses
the Curiously Recurring Template Pattern (<a class="reference external" href="https://en.wikipedia.org/wiki/Curiously_recurring_template_pattern">CRTP</a>). The details of this are
handled by the framework, but functionally this is still just overriding
methods from a base class that handles the details.</p>
<p>Here, our database implementation will simply record the <code class="docutils literal notranslate"><span class="pre">uri</span></code> passed
by the user. Our interpretation of this will be a <code class="docutils literal notranslate"><span class="pre">file://</span></code> uri to
a directory to which our IPC files should be written and/or IPC files
should be read. This is the role of the database in ADBC: a shared
handle to a database that potentially caches some shared state among
connections, but which still allows multiple connections to execute
against the database concurrently.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">134</span><span class="k">class</span><span class="w"> </span><span class="nc">DriverExampleDatabase</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">adbc</span><span class="o">::</span><span class="n">driver</span><span class="o">::</span><span class="n">Database</span><span class="o">&lt;</span><span class="n">DriverExampleDatabase</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">135</span><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="linenos">136</span><span class="w">  </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">kErrorPrefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;[example]&quot;</span><span class="p">;</span>
<span class="linenos">137</span>
<span class="linenos">138</span><span class="w">  </span><span class="n">Status</span><span class="w"> </span><span class="nf">SetOptionImpl</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">Option</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">139</span><span class="w">    </span><span class="c1">// Handle and validate options implemented by this driver</span>
<span class="linenos">140</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;uri&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">141</span><span class="w">      </span><span class="n">UNWRAP_RESULT</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">uri</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">.</span><span class="n">AsString</span><span class="p">());</span>
<span class="linenos">142</span>
<span class="linenos">143</span><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">uri</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;file://&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">144</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">adbc</span><span class="o">::</span><span class="n">driver</span><span class="o">::</span><span class="n">status</span><span class="o">::</span><span class="n">InvalidArgument</span><span class="p">(</span>
<span class="linenos">145</span><span class="w">            </span><span class="s">&quot;[example] uri must start with &#39;file://&#39;&quot;</span><span class="p">);</span>
<span class="linenos">146</span><span class="w">      </span><span class="p">}</span>
<span class="linenos">147</span>
<span class="linenos">148</span><span class="w">      </span><span class="n">uri_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uri</span><span class="p">;</span>
<span class="linenos">149</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">adbc</span><span class="o">::</span><span class="n">driver</span><span class="o">::</span><span class="n">status</span><span class="o">::</span><span class="n">Ok</span><span class="p">();</span>
<span class="linenos">150</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">151</span>
<span class="linenos">152</span><span class="w">    </span><span class="c1">// Defer to the base implementation to handle state managed by the base</span>
<span class="linenos">153</span><span class="w">    </span><span class="c1">// class (and error for all other options).</span>
<span class="linenos">154</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Base</span><span class="o">::</span><span class="n">SetOptionImpl</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<span class="linenos">155</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">156</span>
<span class="linenos">157</span><span class="w">  </span><span class="n">Result</span><span class="o">&lt;</span><span class="n">Option</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetOption</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">158</span><span class="w">    </span><span class="c1">// Return the value of options implemented by this driver</span>
<span class="linenos">159</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;uri&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">160</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">Option</span><span class="p">(</span><span class="n">uri_</span><span class="p">);</span>
<span class="linenos">161</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">162</span>
<span class="linenos">163</span><span class="w">    </span><span class="c1">// Defer to the base implementation to handle state managed by the base</span>
<span class="linenos">164</span><span class="w">    </span><span class="c1">// class (and error for all other options).</span>
<span class="linenos">165</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Base</span><span class="o">::</span><span class="n">GetOption</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<span class="linenos">166</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">167</span>
<span class="linenos">168</span><span class="w">  </span><span class="c1">// This is called after zero or more calls to SetOption() on</span>
<span class="linenos">169</span><span class="w">  </span><span class="n">Status</span><span class="w"> </span><span class="n">InitImpl</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">170</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">uri_</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">171</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">adbc</span><span class="o">::</span><span class="n">driver</span><span class="o">::</span><span class="n">status</span><span class="o">::</span><span class="n">InvalidArgument</span><span class="p">(</span>
<span class="linenos">172</span><span class="w">          </span><span class="s">&quot;[example] Must set uri to a non-empty value&quot;</span><span class="p">);</span>
<span class="linenos">173</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">174</span>
<span class="linenos">175</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Base</span><span class="o">::</span><span class="n">InitImpl</span><span class="p">();</span>
<span class="linenos">176</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">177</span>
<span class="linenos">178</span><span class="w">  </span><span class="c1">// Getters for members needed by the connection and/or statement:</span>
<span class="linenos">179</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">uri</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">uri_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">180</span>
<span class="linenos">181</span><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<span class="linenos">182</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">uri_</span><span class="p">;</span>
<span class="linenos">183</span><span class="p">};</span>
</pre></div>
</div>
<p>Next, we implement the connection. While the role of the database is typically
to store or cache information, the role of the connection is to provide
resource handles that might be expensive to obtain (e.g., negotiating authentication
when connecting to a database). Because our example “database” is just a directory, we
don’t need to do much in our connection in terms of resource management except to
provide a way for child statements to access the database’s uri.</p>
<p>Another role of the connection is to provide metadata about tables, columns,
statistics, and other catalog-like information a caller might want to know before
issuing a query. The driver framework base classes provide helpers to implement these
functions such that you can mostly implement them in terms of the C++17 standard
library (as opposed to building the C-level arrays yourself).</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">198</span><span class="k">class</span><span class="w"> </span><span class="nc">DriverExampleConnection</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">adbc</span><span class="o">::</span><span class="n">driver</span><span class="o">::</span><span class="n">Connection</span><span class="o">&lt;</span><span class="n">DriverExampleConnection</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">199</span><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="linenos">200</span><span class="w">  </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">kErrorPrefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;[example]&quot;</span><span class="p">;</span>
<span class="linenos">201</span>
<span class="linenos">202</span><span class="w">  </span><span class="c1">// Get information from the database and/or store a reference if needed.</span>
<span class="linenos">203</span><span class="w">  </span><span class="n">Status</span><span class="w"> </span><span class="nf">InitImpl</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">204</span><span class="w">    </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">database</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">DriverExampleDatabase</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
<span class="linenos">205</span><span class="w">    </span><span class="n">uri_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">database</span><span class="p">.</span><span class="n">uri</span><span class="p">();</span>
<span class="linenos">206</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Base</span><span class="o">::</span><span class="n">InitImpl</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
<span class="linenos">207</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">208</span>
<span class="linenos">209</span><span class="w">  </span><span class="c1">// Getters for members needed by the statement:</span>
<span class="linenos">210</span><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">uri</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">uri_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<span class="linenos">211</span>
<span class="linenos">212</span><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<span class="linenos">213</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">uri_</span><span class="p">;</span>
<span class="linenos">214</span><span class="p">};</span>
</pre></div>
</div>
<p>Next, we provide the statement implementation. The statement is where query execution
is managed. Because our data source is quite literally Arrow data, we don’t have to
provide a layer that manages type or value conversion. The SQLite and PostgreSQL
drivers both dedicate many lines of code to implementing and testing these conversions
efficiently. The nanoarrow library can be used to implement conversions in both
directions and is the scope of a separate article.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">223</span><span class="k">class</span><span class="w"> </span><span class="nc">DriverExampleStatement</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">adbc</span><span class="o">::</span><span class="n">driver</span><span class="o">::</span><span class="n">Statement</span><span class="o">&lt;</span><span class="n">DriverExampleStatement</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">224</span><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<span class="linenos">225</span><span class="w">  </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="w"> </span><span class="n">kErrorPrefix</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;[example]&quot;</span><span class="p">;</span>
<span class="linenos">226</span>
<span class="linenos">227</span><span class="w">  </span><span class="c1">// Get information from the connection and/or store a reference if needed.</span>
<span class="linenos">228</span><span class="w">  </span><span class="n">Status</span><span class="w"> </span><span class="nf">InitImpl</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">229</span><span class="w">    </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">connection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">DriverExampleConnection</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
<span class="linenos">230</span><span class="w">    </span><span class="n">uri_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">connection</span><span class="p">.</span><span class="n">uri</span><span class="p">();</span>
<span class="linenos">231</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">Base</span><span class="o">::</span><span class="n">InitImpl</span><span class="p">(</span><span class="n">parent</span><span class="p">);</span>
<span class="linenos">232</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">233</span>
<span class="linenos">234</span><span class="w">  </span><span class="c1">// Our implementation of a bulk ingestion is to write an Arrow IPC stream as a file</span>
<span class="linenos">235</span><span class="w">  </span><span class="c1">// using the target table as the filename.</span>
<span class="linenos">236</span><span class="w">  </span><span class="n">Result</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ExecuteIngestImpl</span><span class="p">(</span><span class="n">IngestState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">237</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uri_</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="s">&quot;file://&quot;</span><span class="p">));</span>
<span class="linenos">238</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="o">*</span><span class="n">state</span><span class="p">.</span><span class="n">target_table</span><span class="p">;</span>
<span class="linenos">239</span>
<span class="linenos">240</span><span class="w">    </span><span class="n">nanoarrow</span><span class="o">::</span><span class="n">ipc</span><span class="o">::</span><span class="n">UniqueOutputStream</span><span class="w"> </span><span class="n">output_stream</span><span class="p">;</span>
<span class="linenos">241</span><span class="w">    </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">c_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">fopen</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;wb&quot;</span><span class="p">);</span>
<span class="linenos">242</span><span class="w">    </span><span class="n">UNWRAP_ERRNO</span><span class="p">(</span><span class="n">Internal</span><span class="p">,</span><span class="w"> </span><span class="n">ArrowIpcOutputStreamInitFile</span><span class="p">(</span><span class="n">output_stream</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">c_file</span><span class="p">,</span>
<span class="linenos">243</span><span class="w">                                                        </span><span class="cm">/*close_on_release*/</span><span class="w"> </span><span class="nb">true</span><span class="p">));</span>
<span class="linenos">244</span>
<span class="linenos">245</span><span class="w">    </span><span class="n">nanoarrow</span><span class="o">::</span><span class="n">ipc</span><span class="o">::</span><span class="n">UniqueWriter</span><span class="w"> </span><span class="n">writer</span><span class="p">;</span>
<span class="linenos">246</span><span class="w">    </span><span class="n">UNWRAP_ERRNO</span><span class="p">(</span><span class="n">Internal</span><span class="p">,</span><span class="w"> </span><span class="n">ArrowIpcWriterInit</span><span class="p">(</span><span class="n">writer</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">output_stream</span><span class="p">.</span><span class="n">get</span><span class="p">()));</span>
<span class="linenos">247</span>
<span class="linenos">248</span><span class="w">    </span><span class="n">ArrowError</span><span class="w"> </span><span class="n">nanoarrow_error</span><span class="p">;</span>
<span class="linenos">249</span><span class="w">    </span><span class="n">ArrowErrorInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nanoarrow_error</span><span class="p">);</span>
<span class="linenos">250</span><span class="w">    </span><span class="n">UNWRAP_NANOARROW</span><span class="p">(</span><span class="n">nanoarrow_error</span><span class="p">,</span><span class="w"> </span><span class="n">Internal</span><span class="p">,</span>
<span class="linenos">251</span><span class="w">                     </span><span class="n">ArrowIpcWriterWriteArrayStream</span><span class="p">(</span><span class="n">writer</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="o">&amp;</span><span class="n">bind_parameters_</span><span class="p">,</span>
<span class="linenos">252</span><span class="w">                                                    </span><span class="o">&amp;</span><span class="n">nanoarrow_error</span><span class="p">));</span>
<span class="linenos">253</span>
<span class="linenos">254</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">255</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">256</span>
<span class="linenos">257</span><span class="w">  </span><span class="c1">// Our implementation of query execution is to accept a simple query in the form</span>
<span class="linenos">258</span><span class="w">  </span><span class="c1">// SELECT * FROM (the filename).</span>
<span class="linenos">259</span><span class="w">  </span><span class="n">Result</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ExecuteQueryImpl</span><span class="p">(</span><span class="n">QueryState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">ArrowArrayStream</span><span class="o">*</span><span class="w"> </span><span class="n">stream</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">260</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">prefix</span><span class="p">(</span><span class="s">&quot;SELECT * FROM &quot;</span><span class="p">);</span>
<span class="linenos">261</span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">262</span><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">adbc</span><span class="o">::</span><span class="n">driver</span><span class="o">::</span><span class="n">status</span><span class="o">::</span><span class="n">InvalidArgument</span><span class="p">(</span>
<span class="linenos">263</span><span class="w">          </span><span class="s">&quot;[example] Query must be in the form &#39;SELECT * FROM filename&#39;&quot;</span><span class="p">);</span>
<span class="linenos">264</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">265</span>
<span class="linenos">266</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uri_</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="s">&quot;file://&quot;</span><span class="p">));</span>
<span class="linenos">267</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">prefix</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="linenos">268</span>
<span class="linenos">269</span><span class="w">    </span><span class="n">nanoarrow</span><span class="o">::</span><span class="n">ipc</span><span class="o">::</span><span class="n">UniqueInputStream</span><span class="w"> </span><span class="n">input_stream</span><span class="p">;</span>
<span class="linenos">270</span><span class="w">    </span><span class="kt">FILE</span><span class="o">*</span><span class="w"> </span><span class="n">c_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">fopen</span><span class="p">(</span><span class="n">filename</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;rb&quot;</span><span class="p">);</span>
<span class="linenos">271</span><span class="w">    </span><span class="n">UNWRAP_ERRNO</span><span class="p">(</span><span class="n">Internal</span><span class="p">,</span><span class="w"> </span><span class="n">ArrowIpcInputStreamInitFile</span><span class="p">(</span><span class="n">input_stream</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="n">c_file</span><span class="p">,</span>
<span class="linenos">272</span><span class="w">                                                       </span><span class="cm">/*close_on_release*/</span><span class="w"> </span><span class="nb">true</span><span class="p">));</span>
<span class="linenos">273</span>
<span class="linenos">274</span><span class="w">    </span><span class="n">UNWRAP_ERRNO</span><span class="p">(</span><span class="n">Internal</span><span class="p">,</span>
<span class="linenos">275</span><span class="w">                 </span><span class="n">ArrowIpcArrayStreamReaderInit</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span><span class="w"> </span><span class="n">input_stream</span><span class="p">.</span><span class="n">get</span><span class="p">(),</span><span class="w"> </span><span class="k">nullptr</span><span class="p">));</span>
<span class="linenos">276</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<span class="linenos">277</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">278</span>
<span class="linenos">279</span><span class="w">  </span><span class="c1">// This path is taken when the user calls Prepare() first.</span>
<span class="linenos">280</span><span class="w">  </span><span class="n">Result</span><span class="o">&lt;</span><span class="kt">int64_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ExecuteQueryImpl</span><span class="p">(</span><span class="n">PreparedState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">ArrowArrayStream</span><span class="o">*</span><span class="w"> </span><span class="n">stream</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">281</span><span class="w">    </span><span class="n">QueryState</span><span class="w"> </span><span class="n">query_state</span><span class="p">{</span><span class="n">state</span><span class="p">.</span><span class="n">query</span><span class="p">};</span>
<span class="linenos">282</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ExecuteQueryImpl</span><span class="p">(</span><span class="n">query_state</span><span class="p">,</span><span class="w"> </span><span class="n">stream</span><span class="p">);</span>
<span class="linenos">283</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">284</span>
<span class="linenos">285</span><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<span class="linenos">286</span><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">uri_</span><span class="p">;</span>
<span class="linenos">287</span><span class="p">};</span>
<span class="linenos">288</span>
<span class="linenos">289</span><span class="p">}</span><span class="w">  </span><span class="c1">// namespace</span>
</pre></div>
</div>
<p>Finally, we create the driver initializer function, which is what the driver
manager needs to provide implementations for the <code class="docutils literal notranslate"><span class="pre">Adbc**()</span></code> functions that
comprise the ADBC C API. The name of this function matters: this file will
be built into a shared library named <code class="docutils literal notranslate"><span class="pre">libdriver_example.(so|dll|dylib)</span></code>,
so the driver manager will look for the symbol <code class="docutils literal notranslate"><span class="pre">AdbcDriverExampleInit()</span></code>
as the default entry point when asked to load the driver <code class="docutils literal notranslate"><span class="pre">&quot;driver_example&quot;</span></code>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">298</span><span class="k">extern</span><span class="w"> </span><span class="s">&quot;C&quot;</span><span class="w"> </span><span class="n">AdbcStatusCode</span><span class="w"> </span><span class="n">AdbcDriverExampleInit</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">raw_driver</span><span class="p">,</span>
<span class="linenos">299</span><span class="w">                                                </span><span class="n">AdbcError</span><span class="o">*</span><span class="w"> </span><span class="n">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">300</span><span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="n">ExampleDriver</span><span class="w"> </span><span class="o">=</span>
<span class="linenos">301</span><span class="w">      </span><span class="n">adbc</span><span class="o">::</span><span class="n">driver</span><span class="o">::</span><span class="n">Driver</span><span class="o">&lt;</span><span class="n">DriverExampleDatabase</span><span class="p">,</span><span class="w"> </span><span class="n">DriverExampleConnection</span><span class="p">,</span>
<span class="linenos">302</span><span class="w">                           </span><span class="n">DriverExampleStatement</span><span class="o">&gt;</span><span class="p">;</span>
<span class="linenos">303</span><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ExampleDriver</span><span class="o">::</span><span class="n">Init</span><span class="p">(</span><span class="n">version</span><span class="p">,</span><span class="w"> </span><span class="n">raw_driver</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">);</span>
<span class="linenos">304</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="low-level-testing">
<h2>Low-level testing<a class="headerlink" href="#low-level-testing" title="Link to this heading">¶</a></h2>
<p>Recipe source: <a class="reference external" href="https://github.com/apache/arrow-adbc/blob/main/docs/source/cpp/recipe_driver/driver_example_test.cc">driver_example_test.cc</a></p>
<p>After we’ve written a sketch of the driver, the next step is to
ensure that it can be loaded by the driver manager and that the
database, connection, and statement instances can be initialized and
released.</p>
<p>First, we’ll include the driver manager and <a class="reference external" href="https://github.com/google/googletest">googletest</a>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">29</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;driver_example.h&quot;</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;arrow-adbc/adbc_driver_manager.h&quot;</span>
<span class="linenos">32</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gtest/gtest.h&quot;</span>
</pre></div>
</div>
<p>Next we’ll declare a test case for the basic lifecycle:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="linenos">36</span><span class="n">TEST</span><span class="p">(</span><span class="n">DriverExample</span><span class="p">,</span><span class="w"> </span><span class="n">TestLifecycle</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">37</span><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">AdbcError</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ADBC_ERROR_INIT</span><span class="p">;</span>
<span class="linenos">38</span>
<span class="linenos">39</span><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">AdbcDatabase</span><span class="w"> </span><span class="n">database</span><span class="p">;</span>
<span class="linenos">40</span><span class="w">  </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">AdbcDatabaseNew</span><span class="p">(</span><span class="o">&amp;</span><span class="n">database</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="n">ADBC_STATUS_OK</span><span class="p">);</span>
<span class="linenos">41</span><span class="w">  </span><span class="n">AdbcDriverManagerDatabaseSetInitFunc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">database</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">AdbcDriverExampleInit</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
<span class="linenos">42</span><span class="w">  </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">AdbcDatabaseSetOption</span><span class="p">(</span><span class="o">&amp;</span><span class="n">database</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;uri&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;file://foofy&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">),</span>
<span class="linenos">43</span><span class="w">            </span><span class="n">ADBC_STATUS_OK</span><span class="p">);</span>
<span class="linenos">44</span><span class="w">  </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">AdbcDatabaseInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">database</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="n">ADBC_STATUS_OK</span><span class="p">);</span>
<span class="linenos">45</span>
<span class="linenos">46</span><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">AdbcConnection</span><span class="w"> </span><span class="n">connection</span><span class="p">;</span>
<span class="linenos">47</span><span class="w">  </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">AdbcConnectionNew</span><span class="p">(</span><span class="o">&amp;</span><span class="n">connection</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="n">ADBC_STATUS_OK</span><span class="p">);</span>
<span class="linenos">48</span><span class="w">  </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">AdbcConnectionInit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">connection</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">database</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="n">ADBC_STATUS_OK</span><span class="p">);</span>
<span class="linenos">49</span>
<span class="linenos">50</span><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">AdbcStatement</span><span class="w"> </span><span class="n">statement</span><span class="p">;</span>
<span class="linenos">51</span><span class="w">  </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">AdbcStatementNew</span><span class="p">(</span><span class="o">&amp;</span><span class="n">connection</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="n">ADBC_STATUS_OK</span><span class="p">);</span>
<span class="linenos">52</span>
<span class="linenos">53</span><span class="w">  </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">AdbcStatementRelease</span><span class="p">(</span><span class="o">&amp;</span><span class="n">statement</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="n">ADBC_STATUS_OK</span><span class="p">);</span>
<span class="linenos">54</span><span class="w">  </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">AdbcConnectionRelease</span><span class="p">(</span><span class="o">&amp;</span><span class="n">connection</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="n">ADBC_STATUS_OK</span><span class="p">);</span>
<span class="linenos">55</span><span class="w">  </span><span class="n">ASSERT_EQ</span><span class="p">(</span><span class="n">AdbcDatabaseRelease</span><span class="p">(</span><span class="o">&amp;</span><span class="n">database</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">error</span><span class="p">),</span><span class="w"> </span><span class="n">ADBC_STATUS_OK</span><span class="p">);</span>
<span class="linenos">56</span>
<span class="linenos">57</span><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">release</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">58</span><span class="w">    </span><span class="n">error</span><span class="p">.</span><span class="n">release</span><span class="p">(</span><span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>
<span class="linenos">59</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">60</span><span class="p">}</span>
</pre></div>
</div>
<p>Drivers that live in the apache/arrow-adbc repository can use the built-in
validation library that implements a generic test suite against a fully-featured
SQL database and provides utilities to test a range of inputs and outputs.</p>
</section>
<section id="high-level-testing">
<h2>High-level testing<a class="headerlink" href="#high-level-testing" title="Link to this heading">¶</a></h2>
<p>Recipe source: <a class="reference external" href="https://github.com/apache/arrow-adbc/blob/main/docs/source/cpp/recipe_driver/driver_example.py">driver_example.py</a></p>
<p>After verifying the basic driver functionality, we can use the
<code class="docutils literal notranslate"><span class="pre">adbc_driver_manager</span></code> Python package’s built-in dbapi implementation
to expose a ready-to-go Pythonic database API. This is also useful for
high-level testing!</p>
<p>First, we’ll import pathlib for a few path calculations and the
<code class="docutils literal notranslate"><span class="pre">adbc_driver_manager</span></code>’s <code class="docutils literal notranslate"><span class="pre">dbapi</span></code> module:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">26</span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="kn">from</span><span class="w"> </span><span class="nn">adbc_driver_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">dbapi</span>
</pre></div>
</div>
<p>Next, we’ll define a <code class="docutils literal notranslate"><span class="pre">connect()</span></code> function that wraps <code class="docutils literal notranslate"><span class="pre">dbapi.connect()</span></code>
with the location of the shared library we built using <code class="docutils literal notranslate"><span class="pre">cmake</span></code> in the previous
section. For the purposes of our tutorial, this will be in the CMake <code class="docutils literal notranslate"><span class="pre">build/</span></code>
directory.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">35</span><span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="n">uri</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="linenos">36</span>    <span class="n">build_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;build&quot;</span>
<span class="linenos">37</span>    <span class="k">for</span> <span class="n">lib</span> <span class="ow">in</span> <span class="p">[</span>
<span class="linenos">38</span>        <span class="s2">&quot;libdriver_example.dylib&quot;</span><span class="p">,</span>
<span class="linenos">39</span>        <span class="s2">&quot;libdriver_example.so&quot;</span><span class="p">,</span>
<span class="linenos">40</span>        <span class="s2">&quot;driver_example.dll&quot;</span><span class="p">,</span>
<span class="linenos">41</span>    <span class="p">]:</span>
<span class="linenos">42</span>        <span class="n">driver_lib</span> <span class="o">=</span> <span class="n">build_dir</span> <span class="o">/</span> <span class="n">lib</span>
<span class="linenos">43</span>        <span class="k">if</span> <span class="n">driver_lib</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
<span class="linenos">44</span>            <span class="k">return</span> <span class="n">dbapi</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
<span class="linenos">45</span>                <span class="n">driver</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">driver_lib</span><span class="o">.</span><span class="n">resolve</span><span class="p">()),</span> <span class="n">db_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;uri&quot;</span><span class="p">:</span> <span class="n">uri</span><span class="p">}</span>
<span class="linenos">46</span>            <span class="p">)</span>
<span class="linenos">47</span>
<span class="linenos">48</span>    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t find driver shared object&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Next, we can give our driver a go! The two pieces we implemented in the driver
were the “bulk ingest” feature and “select all from”, so let’s see if it works!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">53</span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
<span class="linenos">54</span>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="linenos">55</span>
<span class="linenos">56</span>    <span class="kn">import</span><span class="w"> </span><span class="nn">pyarrow</span>
<span class="linenos">57</span>
<span class="linenos">58</span>    <span class="k">with</span> <span class="n">connect</span><span class="p">(</span><span class="n">uri</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">as_uri</span><span class="p">())</span> <span class="k">as</span> <span class="n">con</span><span class="p">:</span>
<span class="linenos">59</span>        <span class="n">data</span> <span class="o">=</span> <span class="n">pyarrow</span><span class="o">.</span><span class="n">table</span><span class="p">({</span><span class="s2">&quot;col&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]})</span>
<span class="linenos">60</span>        <span class="k">with</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
<span class="linenos">61</span>            <span class="n">cur</span><span class="o">.</span><span class="n">adbc_ingest</span><span class="p">(</span><span class="s2">&quot;example.arrows&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;create&quot;</span><span class="p">)</span>
<span class="linenos">62</span>
<span class="linenos">63</span>        <span class="k">with</span> <span class="n">con</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cur</span><span class="p">:</span>
<span class="linenos">64</span>            <span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM example.arrows&quot;</span><span class="p">)</span>
<span class="linenos">65</span>            <span class="nb">print</span><span class="p">(</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
<span class="linenos">66</span>
<span class="linenos">67</span>        <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;example.arrows&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>High-level tests can also be written in R using the <code class="docutils literal notranslate"><span class="pre">adbcdrivermanager</span></code>
package.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">adbcdrivermanager</span><span class="p">)</span>

<span class="n">drv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">adbc_driver</span><span class="p">(</span><span class="s">&quot;build/libdriver_example.dylib&quot;</span><span class="p">)</span>
<span class="n">db</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">adbc_database_init</span><span class="p">(</span><span class="n">drv</span><span class="p">,</span><span class="w"> </span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">paste0</span><span class="p">(</span><span class="s">&quot;file://&quot;</span><span class="p">,</span><span class="w"> </span><span class="nf">getwd</span><span class="p">()))</span>
<span class="n">con</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">adbc_connection_init</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>

<span class="nf">data.frame</span><span class="p">(</span><span class="n">col</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">write_adbc</span><span class="p">(</span><span class="n">con</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;example.arrows&quot;</span><span class="p">)</span>
<span class="n">con</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">read_adbc</span><span class="p">(</span><span class="s">&quot;SELECT * FROM example.arrows&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nf">as.data.frame</span><span class="p">()</span>
<span class="nf">unlink</span><span class="p">(</span><span class="s">&quot;example.arrows&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="api/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">C/C++ API Reference</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="concurrency.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Concurrency and Thread Safety</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022–2024 The Apache Software Foundation.  Apache Arrow, Arrow,
Apache, the Apache feather logo, and the Apache Arrow project logo are either
registered trademarks or trademarks of The Apache Software Foundation in the
United States and other countries.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Driver Example</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#building">Building</a></li>
<li><a class="reference internal" href="#building-an-adbc-driver-using-c">Building an ADBC Driver using C++</a></li>
<li><a class="reference internal" href="#low-level-testing">Low-level testing</a></li>
<li><a class="reference internal" href="#high-level-testing">High-level testing</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=9008d292"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    
<script async defer src="../../version.js"></script></body>
</html>