# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.

From 3306ca07f4a7a83837fe69d0f5d515c3f825f795 Mon Sep 17 00:00:00 2001
From: David Li <li.davidm96@gmail.com>
Date: Mon, 15 Sep 2025 15:01:53 +0900
Subject: [PATCH] Work around lz4 CMake
 (https://github.com/lz4/lz4/issues/1550)

---
 ports/lz4/CMakeLists.txt |  2 +-
 ports/lz4/lz4-cmake.diff | 25 +++++++++++++++++++++++++
 ports/lz4/portfile.cmake |  2 ++
 3 files changed, 28 insertions(+), 1 deletion(-)
 create mode 100644 ports/lz4/lz4-cmake.diff

diff --git a/ports/lz4/CMakeLists.txt b/ports/lz4/CMakeLists.txt
index a35c8b2d1a..50ffd36954 100644
--- a/ports/lz4/CMakeLists.txt
+++ b/ports/lz4/CMakeLists.txt
@@ -1,4 +1,4 @@
-cmake_minimum_required(VERSION 3.0)
+cmake_minimum_required(VERSION 3.10)
 project(lz4 C)
 
 if(MSVC AND BUILD_SHARED_LIBS)
diff --git a/ports/lz4/lz4-cmake.diff b/ports/lz4/lz4-cmake.diff
new file mode 100644
index 0000000000..7c27cd2890
--- /dev/null
+++ b/ports/lz4/lz4-cmake.diff
@@ -0,0 +1,25 @@
+From 678d65fa825b8613ae1c57d6173440e11c568fef Mon Sep 17 00:00:00 2001
+From: David Li <li.davidm96@gmail.com>
+Date: Mon, 15 Sep 2025 15:15:34 +0900
+Subject: [PATCH] Change minimum CMake
+
+---
+ build/cmake/CMakeLists.txt | 2 +-
+ 1 file changed, 1 insertion(+), 1 deletion(-)
+
+diff --git a/build/cmake/CMakeLists.txt b/build/cmake/CMakeLists.txt
+index eb7007b4..8e9517fd 100644
+--- a/build/cmake/CMakeLists.txt
++++ b/build/cmake/CMakeLists.txt
+@@ -10,7 +10,7 @@
+ # LZ4's CMake support is maintained by Evan Nemerson; when filing
+ # bugs please mention @nemequ to make sure I see it.
+ 
+-cmake_minimum_required(VERSION 2.8.12)
++cmake_minimum_required(VERSION 3.10)
+ 
+ set(LZ4_TOP_SOURCE_DIR "${CMAKE_CURRENT_SOURCE_DIR}/../..")
+ 
+-- 
+2.48.1
+
diff --git a/ports/lz4/portfile.cmake b/ports/lz4/portfile.cmake
index 80df95aebc..4c2fa23209 100644
--- a/ports/lz4/portfile.cmake
+++ b/ports/lz4/portfile.cmake
@@ -4,6 +4,8 @@ vcpkg_from_github(
     REF v1.9.4
     SHA512 043a9acb2417624019d73db140d83b80f1d7c43a6fd5be839193d68df8fd0b3f610d7ed4d628c2a9184f7cde9a0fd1ba9d075d8251298e3eb4b3a77f52736684
     HEAD_REF dev
+    PATCHES
+        lz4-cmake.diff
 )
 
 file(COPY "${CMAKE_CURRENT_LIST_DIR}/CMakeLists.txt" DESTINATION "${SOURCE_PATH}")
-- 
2.48.1

